<!doctype html>
<meta charset="utf-8">
<html>
	<head>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://d3js.org/d3-path.v1.min.js"></script>
		<script src="https://d3js.org/d3-scale.v1.min.js"></script>
	</head>
	<body>
		<h1>Hello World!</h1>
		<script>
/* Prepare CSV Data
***********************************************************************/
// CSV column types for streets_lines.csv
var slConverter = function(d) {
	return {
		id: +d.line,
		streetname: d.streetname,
		directions: d.directions,
		x1: +d.x1,
		y1: +d.y1,
		x2: +d.x2,
		y2: +d.y2
	};
};



/* Setup SVGs
***********************************************************************/
var svgW = 1200;
var svgH = 500;

// Create SVG container
var svgContainer = d3.select("body").append("svg")
	.attr("width", svgW)
	.attr("height", svgH);

// Create Label Group
var labelGroup = svgContainer.append("g")
	.attr("id", "labelgroup");

// Create streets_segments Group
var ssGroup = svgContainer.append("g")
	.attr("id", "ssgroup");

// Create streets_lines Group
var slGroup = svgContainer.append("g")
	.attr("id", "slgroup");



/* Scale SVGs
***********************************************************************/
var xArr, yArr, xMin, xMax, yMin, yMax, xScale, yScale;
function scaling(arr) {
	xArr = [(d3.max(arr, function(obj) {return obj.x1;})),
			(d3.max(arr, function(obj) {return obj.x2;})),
			(d3.min(arr, function(obj) {return obj.x1;})),
			(d3.min(arr, function(obj) {return obj.x2;}))];
			
	yArr = [(d3.max(arr, function(obj) {return obj.y1;})),
			(d3.max(arr, function(obj) {return obj.y2;})),
			(d3.min(arr, function(obj) {return obj.y1;})),
			(d3.min(arr, function(obj) {return obj.y2;}))];
	
	xMin = d3.min(xArr);
	xMax = d3.max(xArr);
	yMin = d3.min(yArr);
	yMax = d3.max(yArr);

	xScale = d3.scaleLinear()
		.domain([xMin, xMax])
		.range([100, svgW-100]); // 100px SVG whitespace buffer
	yScale = d3.scaleLinear()
		.domain([yMin, yMax])
		.range([100, svgH-100]); // 100px SVG whitespace buffer
}



/* Functions to draw SVGs
***********************************************************************/
var slstroke = "black";
var slstrokeWidth = 2;
var sllinecap = "round";
var slpathfill = "none";

// Create path generator
var path;
function pathFunc(obj) {
	path = d3.path();
	path.moveTo(xScale(obj.x1),yScale(obj.y1));
	path.lineTo(xScale(obj.x2),yScale(obj.y2));
	return path;
}

// draw all street objects in data array
function slpathGen(arr) {
	d3.select("#slgroup")
		.selectAll("path")
		.data(arr)
		.enter()
		.append("path")
		.attr("id", function(obj) {return obj.streetname;})
		.attr("d", function(obj) {return pathFunc(obj);})
		.attr("stroke", slstroke)
		.attr("stroke-width", slstrokeWidth)
		.attr("stroke-linecap", sllinecap)
		.attr("fill", slpathfill);
}



/* Functions to label SVGs
***********************************************************************/
var fontsize = "12px";
var fontfill = "black";

var anchEW = "end";
var anchNS = "start";
var dxEW = -20;
var dxNS = 20;
var dyEW = ".35em"; // add half the text's height to its y attribute
var dyNS = ".35em"; // add half the text's height to its y attribute

function labelStreets(arr) {
	d3.select("#labelgroup")
		.selectAll("text")
		.data(arr)
		.enter()
		.append("text")
		.text(function(obj) {if (obj.streetname == "Front1") {return "Front";}
							else if (obj.streetname == "Front2") {return "";}
							else {return obj.streetname;};})
		.attr("x", function(obj) {return xScale(obj.x1);})
		.attr("y", function(obj) {return yScale(obj.y1);})
		.attr("font_size", fontsize)
		.attr("fill", fontfill)
		.attr("text-anchor", function(obj) {if (obj.directions == "NS") {return anchNS;}
											else {return anchEW;};})
		.attr("transform", function(obj) {if (obj.directions == "NS")
											 {return "rotate(270 " 
											 + xScale(obj.x1) + "," + yScale(obj.y1) + ")";}
										else {return "";};})
		.attr("dx", function(obj) {if (obj.directions == "NS") {return dxNS;}
									else {return dxEW;};})
		.attr("dy", function(obj) {if (obj.directions == "NS") {return dyNS;}
									else {return dyEW;};});
}



/* Draw SVGs
***********************************************************************/
// Load data and execute functions requiring immediate access to data
var streets_lines = [];
d3.csv("streets_lines.csv", function(sl) {
	streets_lines = sl.map(slConverter);
	scaling(streets_lines);
	labelStreets(streets_lines);
	slpathGen(streets_lines);
});






		</script>
	</body>
</html>
